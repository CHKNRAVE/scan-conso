<!doctype html>
<html lang="fr">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>À propos de Scan Conso</title>
		<style>
			html, body {
				max-width: 100%;
				margin-bottom: 2em !important;
			}
			main {
				text-align: justify;
				max-width: 90vw;
				margin: 0 auto;
			}
			li {
				max-width: 80vw;
			}
			p {
				margin-block-end: 0.75em;
			}
			h1, h2, h3 {
				margin-block-start: 1.25em;
			}
			#root {
				min-height: unset !important;
			}
			#storageButtons {
				display: flex;
				flex-flow: wrap;
				row-gap: 0.5em;
				justify-content: center;
				margin-block-end: 0.75em;
			}
			#storageButtons button {
				font-size: 1em;
			}
		</style>
		<link rel="icon" href="favicon.svg">
	</head>
	<body>
		<div id="root"></div>
		<script type="module" src="/src/about.jsx"></script>
		<script>
			popUpLocalStorage = function() {
				console.log(localStorage);
				if(Object.keys(localStorage).length) {
					alert(JSON.stringify(localStorage));
				} else {
					alert("L'objet localStorage est actuellement vide. Scannez un premier code-barres, et des premières données seront visibles dans cette alerte.");
				};
			};
			clearLocalStorage = function() {
				const clearConfirmed = confirm("Voulez-vous vraiment vider vos données locales pour Scan Conso ?\nAssurez-vous de les avoir exportées, il s'agit de tous vos codes-barres.");
				if(!clearConfirmed) return;
				localStorage.clear();
				alert("Les données locales ont été effacées.");
			};
			exportLocalStorage = function() {
				const localStorageContents = JSON.stringify(localStorage || {});
				navigator.clipboard.writeText(localStorageContents);
				alert("Vos données locales sont maintenant dans votre presse-papiers (copier-coller).\nCollez-les où le souhaitez, par exemple pour transférer vers un autre navigateur.\nCertains navigateurs peuvent demander votre autorisation avant que la copie soit effectuée.");
			};
			importLocalStorage = function() {
				const pastedContents = prompt("Collez les données à ajouter.");
				if(!pastedContents) return;
				try {
					const pastedObject = JSON.parse(pastedContents);
					console.log("Pasted object", pastedObject);
					for(const key of Object.keys(pastedObject)) {

						const localItem = JSON.parse(localStorage.getItem(key) || "{}");
						const pastedItem = JSON.parse(pastedObject[key]) || {};
						const combinedItem = {...localItem, ...pastedItem};

						localStorage.setItem(key, JSON.stringify(combinedItem));
					};
					alert("Importation effectuée. Si un code existant est identique à un que vous avez collé, son surnom est remplacé.");
				} catch (error) {
					alert(`Vous n'avez pas collé des données valides.\nLe format attendu est sous la forne: { }`);
				}
			};
			resetDismissedRecalls = function() {
				localStorage.setItem("dismissed", "[]");
				alert("Votre liste de rappels masqués est maintenant vide.");
			};
		</script>
		<main>
			<h2>Le projet</h2>
			<p>Scan Conso est une application basée sur l'API <a href='https://data.economie.gouv.fr/explore/dataset/rappelconso-v2-gtin-trie/information/'>RappelConso V2</a>, documentée sur le site "open data" du site du ministère français de l'Économie.</p>
			<p>Cette application est développée par une seule personne indépendante. J'ai débuté ce projet dans le but de maîtriser <a href="https://react.dev/">React</a>. Bien entendu, comme je ne fais que commencer, Scan Conso va continuer d'être amélioré au fil du temps.</p>
			<p>Les icônes utilisées viennent de <a href="https://fontawesome.com/">Font Awesome</a>, elles sont gratuites et open-source.</p>

			<h2>Responsabilités</h2>
			<p>Cette application web ne peut pas être tenue responsable en cas de donnée non-répertoriée au moment de tout incident. Je ne fais que rendre les informations disponibles plus accessibles.</p>
			<p>La création et la maintenance de cette application sont une initiative personnelle sans lien avec mon activité professionnelle.</p>

			<h2>Vie privée</h2>
			<p>Les recherches de rappels que vous effectuez via cette application sont envoyées directement de votre navigateur à l'API citée plus haut. Renseignez-vous auprès de votre navigateur et du site du ministère de l'Économie, pour savoir ce qu'ils en font par la suite.</p>
			<p>Cette application ne stocke pas vos codes dans un serveur. Ils sont conservés dans votre navigateur, sans cookie parce que c'est l'application et non un serveur qui les utilise.</p>
			<p>Deux gros avantages :
				<ul>
					<li>Les coûts sont minimisés de mon côté, ce qui me permet de garder cette application en vie plus facilement.</li>
					<li>N'ayant aucune donnée personnelle conservée de mon côté, je ne crains pas d'enfreindre des lois comme le RGPD, et les utilisateurs soucieux de leurs données personnelles sont rassurés.</li>
				</ul>
			</p>
			<p>Attention, effacer vos données temporaires (en vidant votre historique, votre cache...) risque de tout effacer.</p>
			<p>Utilisez les boutons ci-dessous pour manipuler vos données, par exemple pour garder une copie de sauvegarde.</p>
			<div id="storageButtons">
				<button type="button" onclick="exportLocalStorage()">Copier les données locales</button>
				<button type="button" onclick="importLocalStorage()">Importer des données</button>
				<button type="button" onclick="clearLocalStorage()">Effacer les données locales</button>
				<button type="button" onclick="resetDismissedRecalls()">Réinitialiser les rappels masqués</button>
			</div>
			<p>Tout est stocké dans <code>localStorage</code>. Les navigateurs lui accordent une taille maximale de 5Mo en moyenne, soit plus de 130000 codes-barres avec des surnoms de 20 caractères chacun.</p>
			<p>Vous pouvez <a href="javascript:popUpLocalStorage()">cliquer ici</a> pour afficher le contenu de <code>localStorage</code> dans une alerte du navigateur, et ainsi voir 100% de ce qui est stocké dans votre navigateur pour ce site.</p>
			<p>L'application est hébergée via Cloudflare, qui ne garde pas de trace de vos codes-barres scannés ou recherchés.</p>
			<p>gouv.fr et ses autres sites, cependant, enregistrent parfois un cookie quand l'API est appelée.</p>
			<p>Afin de mesurer la popularité de Scan Conso, Cloudflare enregistre aussi le nombre de visites par pays.</p>

			<h2>Fonctionnement</h2>
			<p>À l'aide d'un <a href="https://www.npmjs.com/package/barcode-detector">module détecteur de codes-barres</a>, l'image que vous envoyez est lue localement (en utilisant les ressources de votre appareil) et le premier code-barres trouvé est identifié.</p>
			<p>Si le code correspond bien à l'image, vous pouvez valider, et il sera sauvegardé localement.</p>
			<p>Le détecteur de codes-barres peut ne pas trouver de code. Dans ce cas, vous pouvez le rentrer manuellement.</p>
			<p>
				De retour sur la page principale, l'API du ministère de l'Économie est consultée avec une demande par code-barres.<br>
				Par exemple, pour le code-barres <code>3770001691053</code>, l'URL demandée est <a href="https://data.economie.gouv.fr/api/explore/v2.1/catalog/datasets/rappelconso-v2-gtin-trie/records?where=gtin%3D3770001691053">celle-ci</a>.<br>
				Cette adresse envoie une requête SQL <code>WHERE gtin=3770001691053</code>, ou dont le critère est que le GTIN (le code-barres du produit) soit <code>3770001691053</code>.<br>
				Si vous voulez voir à quoi ressemble un rappel sur Scan Conso, enregistrez manuellement le code-barres <code>3770001691053</code>.
			</p>
			<p>En réponse, l'API envoie une liste de résultats (les différents rappels liés au code-barres demandé) qui peut être vide, au format JSON.</p>
			<p>Il ne reste plus qu'à afficher la réponse de manière plus accessible. Les résultats sont triés dans l'ordre :<ol>
				<li>Rappels trouvés parmi ceux qui ne sont pas masqués</li>
				<li>Erreurs lors de la recherche</li>
				<li>Recherches en cours</li>
				<li>Aucun rappel répertorié</li>
			</ol></p>
			<p>Si un rappel est trouvé, vérifiez les références concernées, et les informations complètes sur Rappel Conso.</p>
			<p>Si le rappel ne concerne pas l'un de vos produits, vous pouvez le masquer, permettant à l'article de revenir à 0 alerte pour vous.</p>
			<h3>Application et notifications</h3>
			<p>Si votre navigateur le permet (notamment Chrome), vous allez pouvoir trouver des boutons en bas de la liste d'articles si au moins un article est ajouté.</p>
			<p>Installer le site en tant qu'application le rend simplement plus facile d'accès.</p>
			<p>Activer les notifications met en place un <i>Service Worker</i> : tant que le site ou son appli n'est pas fermé, toutes les 12 heures, il va effectuer une synchronisation automatique.</p>
			<p>Cette synchronisation va tenter de refaire les demandes de rappels, et s'il en retrouve qui sont plus récents que la dernière vérification, va vous avertir via une notification.</p>
			<p>Tout ça toujours sans stocker de données ailleurs ! Vous n'aurez besoin d'ouvrir Scan Conso que si vous l'avez fermé, si vous avez éteint votre appareil, ou pour toucher à vos codes-barres.</p>

			<h2>Contact</h2>
			<p>Je vous donne la possibilité de me contacter via l'addresse <a href="mailto:contact@scan-conso.fr">contact@scan-conso.fr</a>. Je ne consentis pas au démarchage commercial, cette addresse a pour seul but de vous laisser signaler des bugs de manière aussi complète que vous pouvez.</p>

			<h2>Notes de mises à jour</h2>
			<p><b><time>22 avril 2025</time> :</b> Grandes améliorations sur l'accessibilité de Scan Conso. Le site est maintenant navigable avec facilité à partir d'un lecteur d'écran, notamment au niveau de l'écran de scan.<br>Les erreurs à l'obtention de résultats sont identifiées par leur code tant que l'API a bien répondu à la demande.</p>
			<p><b><time>5 mai 2025</time> :</b> Les lecteurs d'écran lisent désormais les statuts des articles avec leurs surnoms. Ils lisent aussi chiffre par chiffre les codes-barres des tableaux de produits rappelés.</p>
			<p><b><time>25 novembre 2025</time> :</b> Correction d'un bug qui bloquait l'affichage de Scan Conso en entier sur des plateformes comme iPhone. Désactivation des notifications.<br>
			Les navigateurs suivants peuvent maintenant utiliser Scan Conso :
			<ul>
				<li>Chrome Android</li>
				<li>Opera Android</li>
				<li>Safari sur iOS</li>
				<li>Samsung Internet</li>
				<li>WebView Android</li>
				<li>WebView iOS</li>
			</ul>
			</p>
		</main>
	</body>
</html>